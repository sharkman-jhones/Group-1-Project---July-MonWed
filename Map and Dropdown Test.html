<!DOCTYPE html>
<html>

<head>
    <title>New API Retrieval Test</title>
    <link rel="stylesheet" href="assets/CSS/bootstrap.css">
    <link rel="stylesheet" href="assets/CSS/bootstrap-theme.css">
    <link rel="stylesheet" type="text/css" href="API Test Style.css">
</head>

<body>
    <div class="jumbotron">
        <h1>Life Expectancy at Birth</h1>
    </div>
    <div class="container">
        <div class="row">
            <div class="dropdown" id="countryDD">
                <button class="btn btn-large dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                    Country
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu"></ul>
            </div>
            <div id="dataDisplay" style="display:none">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Country</th>
                            <th>Year</th>
                            <th>Years</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div id="map" class="container">
    </div>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAWr2phkQqcN4pR8hzF26p0NyZ0Yda_qSM&callback=initMap&signed_in=true" async defer></script>
    <script src="assets/Javascript/jquery-3.1.0.js"></script>
    <script src="assets/Javascript/bootstrap.js"></script>
    <script>
    var map;

    function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
            center: {
                lat: 0,
                lng: 0
            },
            zoom: 2,
            mapTypeControl: false,
            streetViewControl: false,
            mapTypeId: 'satellite'
        });
        map.setTilt(45);
    }

    $.ajax({
        url: "http://api.undata-api.org/WHO/Life%20expectancy%20at%20birth/countries?app_id=5444b42d&app_key=6090984d2a7a0ef71e838c46fa47d1ad",
        method: "GET"
    })

    .done(function(response) {

        for (x = 0; x < response.length; x++) {
            $("#countryDD>ul").append("<li><a href=\"#\">" + response[x].name + "</a></li>");
        }


        $("#countryDD>ul").on("click", function(event) {


            $("#countryDD>button").text($(event.target).text());

            $.ajax({
                url: "http://api.undata-api.org/WHO/Life%20expectancy%20at%20birth/" + $(event.target).text() + "/records?app_id=5444b42d&app_key=6090984d2a7a0ef71e838c46fa47d1ad",
                method: "GET"
            })

            .done(function(response) {
                $("#dataDisplay").css("display", "inline")
                console.log(response[2].area_name);
                console.log(response[2].year);
                console.log(response[2].value);
                $("#dataDisplay>table>tbody").empty();
                $("#dataDisplay>table>tbody").append("<tr><td>" + response[2].area_name + "</td><td>" + response[2].year + "</td><td>" + response[2].value + "</td></tr>")


            })
        });
    });
    </script>
</body>

</html>
