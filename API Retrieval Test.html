<!DOCTYPE html>
<html>

<head>
    <title>API Retrieval Test</title>
    <link rel="stylesheet" href='assets/CSS/bootstrap.css'>
    <link rel="stylesheet" href='assets/CSS/bootstrap-theme.css'>
    <link rel="stylesheet" type="text/css" href="API Test Style.css">
</head>

<body>
    <div class="dropdown" id="datasetMainDD">
        <button class="btn btn-large dropdown-toggle" type="button" id="dataSetDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
            Dataset Name
            <span class="caret"></span>
        </button>
        <ul class="dropdown-menu" id="datasetListDD"></ul>
    </div>
    <br>
    <div id="dataDisplay" style="display:none">
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Country</th>
                    <th>Value</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
    <script src='assets/Javascript/jquery-3.1.0.js'></script>
    <script src="assets/Javascript/bootstrap.js"></script>
    <script type="text/javascript">
    var selectedDataSet;
    var currentCountryList = [];
    var currentDataValue = [];

    $.ajax({
        url: "http://api.undata-api.org/WHO/datasets?app_id=5444b42d&app_key=6090984d2a7a0ef71e838c46fa47d1ad",
        method: 'GET'
    })

    .done(function(response) {
        for (x = 0; x < response.length; x++) {
            $('#datasetListDD').append('<li><a href="#">' + response[x].name + '</a></li>');

        }

        $("#datasetListDD>li").on('click', function(event) {
            currentCountryList = [];
            currentDataValue = [];
            $('#dataDisplay>table>tbody').empty();
            $('#dataDisplay').css('display', 'inline')

            selectedDataSet = $(event.target).text();


            $.ajax({
                url: "http://api.undata-api.org/WHO/" + selectedDataSet + "/countries?app_id=5444b42d&app_key=6090984d2a7a0ef71e838c46fa47d1ad",
                method: 'GET'
            })

            .done(function(response) {
                for (x = 0; x < response.length; x++) {
                    currentCountryList.push(response[x].name);

                }
                for (x = 0; x < currentCountryList.length; x++) {
                    $.ajax({
                        url: "http://api.undata-api.org/WHO/" + selectedDataSet + "/" + currentCountryList[x] + "/records?app_id=5444b42d&app_key=6090984d2a7a0ef71e838c46fa47d1ad",
                        method: 'GET',
                        async: false
                    })

                    .done(function(response) {
                        currentDataValue.push(response[0].value);
                    });
                }
                console.log(currentCountryList);
                console.log(currentDataValue);
                for (x = 0; x < currentCountryList.length; x++) {
                    $('#dataDisplay>table>tbody').append('<tr><td>' + currentCountryList[x] + '</td><td>' + currentDataValue[x] + '</td></tr>')
                }


            })

        });


    });
    </script>
</body>

</html>
